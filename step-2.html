<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <title>WebRTC Practice</title>
</head>

<body class="bg-gray-50 dark:bg-gray-950">
  <header>
    <nav
      class="flex items-center justify-between w-full relative max-w-2xl border-gray-200 dark:border-gray-700 mx-auto pt-8 pb-8 sm:pb-16 text-gray-900 bg-gray-50 dark:bg-gray-950 bg-opacity-60 dark:text-gray-100">
      <div class="flex justify-center items-center gap-3">
        <a href="step-1.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-1</span>
        </a>
        <a href="step-2.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-2</span>
        </a>
        <a href="step-3.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-3</span>
        </a>
        <a href="step-6.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-6</span>
        </a>
        <a href="step-7.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-7</span>
        </a>
        <a href="step-8.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-8</span>
        </a>
        <a href="step-9.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-9</span>
        </a>
        <a href="step-10.html"
          class="cursor-pointer font-normal text-gray-600 dark:text-gray-400 rounded-lg hover:text-gray-950 dark:hover:text-gray-200 transition-all">
          <span class="capsize">Step-10</span>
        </a>
      </div>
    </nav>
  </header>

  <main class="flex flex-col justify-center items-center">
    <div id="video-streams" class="flex justify-center"></div>
    <h2>Local WebRTC Video Call</h2>
    <div class="p-3 w-full flex justify-center gap-8">
      <video id="localVideo" class="max-w-60" autoplay playsinline controls></video>
      <video id="remoteVideo" class="max-w-60" autoplay playsinline controls></video>
    </div>

    <div class="p-3 flex justify-center gap-4">
      <button onclick="startCall()" type="button"
        class="cursor-pointer px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-500 focus:ring-4 focus:ring-indigo-500">Start
        Call</button>
      <button onclick="stopCall()" type="button"
        class="cursor-pointer px-4 py-2 bg-red-600 text-white rounded hover:bg-red-500 focus:ring-4 focus:ring-red-500">Stop
        Call</button>
    </div>
  </main>
</body>

<script>
  // step 2: Setting Up a Local WebRTC App
  let localStream;
  let peer1, peer2;

  async function stopCall() {
    if (peer1) {
      peer1.close();
      peer1 = null;
    }
    if (peer2) {
      peer2.close();
      peer2 = null;
    }
    if (localStream) {
      localStream.getTracks().forEach(track => track.stop());
      localStream = null;
    }
    document.getElementById('localVideo').srcObject = null;
    document.getElementById('remoteVideo').srcObject = null;
    console.log('Call stopped');
  }

  async function startCall() {
    // Get local media stream
    localStream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    });
    document.getElementById('localVideo').srcObject = localStream;

    // Create RTCPeerConnection instances
    peer1 = new RTCPeerConnection({
      iceServers: [{
        urls: 'stun:stun.l.google.com:19302'
      }]
    });
    peer2 = new RTCPeerConnection({
      iceServers: [{
        urls: 'stun:stun1.l.google.com:19302'
      }]
    });

    // Add local tracks to peer1
    localStream.getTracks().forEach(track => peer1.addTrack(track, localStream));

    // Handle ICE candidates
    peer1.onicecandidate = (event) => {
      if (event.candidate) peer2.addIceCandidate(event.candidate);
    };

    peer2.onicecandidate = (event) => {
      if (event.candidate) peer1.addIceCandidate(event.candidate);
    };

    // Handle remote track
    peer2.ontrack = (event) => {
      document.getElementById('remoteVideo').srcObject = event.streams[0];
    };

    // Create and set offer
    let offer = await peer1.createOffer();
    await peer1.setLocalDescription(offer);
    await peer2.setRemoteDescription(offer);

    // Create and set offer
    let answer = await peer2.createAnswer();
    await peer2.setLocalDescription(answer);
    await peer1.setRemoteDescription(answer);
  }
</script>

</html>